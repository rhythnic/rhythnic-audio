var RhythnicIcon={NS:"http://www.w3.org/2000/svg",draw:function(e,t,n){var r=t||document.createElementNS(this.NS,"svg");bp=this.icons[e];r.setAttribute("viewBox",bp.viewBox);this.drawChildren(r,bp.children,n);return r},drawChildren:function(e,t,n){for(var r=0;r<t.length;r++){var i=this.drawShape(t[r],n);e.appendChild(i)}},drawShape:function(e,t){elem=document.createElementNS(this.NS,e.type);if("title"in e&&(t||e.title)){var n=document.createElementNS(this.NS,"title");if(t)n.innerHTML=t;else n.innerHTML=e.title;elem.appendChild(n)}for(var r in e.attr){elem.setAttribute(r,e.attr[r])}for(r in e.style){elem.style.setProperty(r,e.style[r])}if(e.class){e.class.forEach(function(e){elem.classList.add(e)})}if(e.children)this.drawChildren(elem,e.children,t);return elem},icons:{play:{viewBox:"0 0 12 12",children:[{type:"polygon",attr:{points:"1,1 11,6 1,11"},title:"Play"}]},pause:{viewBox:"0 0 12 12",children:[{type:"rect",attr:{width:"4",height:"10",x:"1",y:"1",rx:"1",ry:"1"}},{type:"rect",attr:{width:"4",height:"10",x:"7",y:"1",rx:"1",ry:"1"}},{type:"rect",attr:{width:"12",height:"12"},style:{"fill-opacity":"0","stroke-opacity":"0"},title:"Pause"}]},menu:{viewBox:"0 0 16 12",children:[{type:"rect",attr:{width:"14",height:"2",x:"1",y:"1"}},{type:"rect",attr:{width:"14",height:"2",x:"1",y:"5"}},{type:"rect",attr:{width:"14",height:"2",x:"1",y:"9"}},{type:"rect",attr:{width:"16",height:"12"},style:{"fill-opacity":"0","stroke-opacity":"0"},title:"Menu"}]}}};function RhythnicAudio(e){this.audio=document.createElement("audio");try{this.audioTest(this.audio)}catch(t){alert(t.message);return}this.container=e;this.controls=this.container.querySelector(".controls");this.playlist=this.container.querySelector(".playlist");this.playBtn=this.controls.querySelector(".play");this.viewBtn=this.controls.querySelector(".plView");this.seek=this.controls.querySelector(".seek");this.duration=this.controls.querySelector(".duration");this.time=this.controls.querySelector(".time");this.tracks=[];this.titles=[];this.getTracksAndTitles(this.playlist);if(this.tracks.length<=1)this.viewBtn.style.setProperty("display","none");this.bTimeSlide=false;this.current=0;this.bindEvents()}var iconMaker=new Object(RhythnicIcon);RhythnicAudio.prototype.init=function(e){this.options=e||{};this.overrideOptions(this.defaultOptions,this.options);if(this.options.hidePlaylist)this.togglePlaylistView();if(this.options.lockPlaylist)this.viewBtn.style.setProperty("display","none");if(this.options.autoplay)this.togglePlay(this.audio.paused);if(this.options.drawIcons)this.drawIcons();this.controls.style.setProperty("display","block");this.removeElementFocus(this.titles);this.playChild=Array.prototype.slice.call(this.playBtn.children);this.playChild[1].classList.add("remove");try{this.audioSetup()}catch(t){alert(t.message);return}};RhythnicAudio.prototype.bindEvents=function(){var e=this;e.playBtn.addEventListener("click",function(t){e.togglePlay(e.audio.paused)});e.viewBtn.addEventListener("click",function(t){e.toggleView(e.playlist,"plHide")});e.playlist.addEventListener("click",function(t){e.onClickPlaylist(t)});e.container.addEventListener("keydown",function(t){e.onKeydownContainer(t)});e.audio.addEventListener("durationchange",function(t){e.onDurationchange()});e.audio.addEventListener("timeupdate",function(t){e.onTimeupdate()});e.audio.addEventListener("ended",function(t){e.onEnded()});e.seek.addEventListener("mousedown",function(t){e.bTimeSlide=true});e.seek.addEventListener("touchstart",function(t){e.bTimeSlide=true});e.seek.addEventListener("change",function(t){e.time.innerHTML=e.formatTime(e.seek.value)});e.seek.addEventListener("mouseup",function(t){e.onPointerdownSeek()});e.seek.addEventListener("touchend",function(t){e.onPointerdownSeek()})};RhythnicAudio.prototype.drawIcons=function(){iconMaker.draw("play",this.playBtn);var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("remove");iconMaker.draw("pause",e);this.playBtn.appendChild(e);params={title:"Playlist View"};iconMaker.draw("menu",this.viewBtn)};RhythnicAudio.prototype.onClickPlaylist=function(e){if(e.target.nodeName!=="A")return;e.preventDefault();this.playTrack(this.titles.indexOf(e.target))};RhythnicAudio.prototype.onKeydownContainer=function(e){switch(e.keyCode){case 32:e.preventDefault();this.togglePlay(this.audio.paused);break;case 37:e.preventDefault();this.audio.currentTime-=2;break;case 39:e.preventDefault();this.audio.currentTime+=2;break;case 38:e.preventDefault();this.playTrack(this.current-1);break;case 40:e.preventDefault();this.playTrack(this.current+1);break}};RhythnicAudio.prototype.onDurationchange=function(){if(this.audio.duration!=Number.POSITIVE_INFINITY&&this.audio.duration!=Number.NEGATIVE_INFINITY&&!isNaN(this.audio.duration)&&this.audio.duration!==0){this.seek.max=this.audio.duration;this.duration.innerHTML="/"+this.formatTime(this.audio.duration)}};RhythnicAudio.prototype.onTimeupdate=function(){if(this.bTimeSlide)return;this.seek.value=this.audio.currentTime;this.time.innerHTML=this.formatTime(this.audio.currentTime)};RhythnicAudio.prototype.onEnded=function(){if(this.tracks.length>1)this.playTrack(this.current+1);else this.togglePlay(false)};RhythnicAudio.prototype.onPointerdownSeek=function(){this.audio.currentTime=this.seek.value;this.bTimeSlide=false};RhythnicAudio.prototype.playTrack=function(e){this.titles[this.current].parentElement.classList.remove("selected");this.current=e<0?this.tracks.length-1:e%this.tracks.length;this.titles[this.current].parentElement.classList.add("selected");this.audio.src=this.tracks[this.current];this.togglePlay(this.audio.paused)};RhythnicAudio.prototype.audioSetup=function(){if(this.audio.canPlayType("audio/"+this.options.mime)){this.audio.type="audio/"+this.options.mime}else{var e=false;for(var t in this.options.tracks){if(this.audio.canPlayType("audio/"+t)){this.audio.type="audio/"+t;this.tracks=this.options.tracks[t];e=true}}if(!e)throw new Error("Your browser doesn't support any of the provided audio file types.")}this.audio.setAttribute("preload",this.options.preload);this.audio.src=this.tracks[this.current];this.titles[this.current].parentElement.classList.add("selected")};RhythnicAudio.prototype.togglePlay=function(e){var t=this;if(e)this.audio.play();else this.audio.pause();if(e&&this.playChild[1].classList.contains("remove")||!e&&this.playChild[0].classList.contains("remove")){this.playChild.forEach(function(e){t.toggleView(e,"remove")})}};RhythnicAudio.prototype.getTracksAndTitles=function(e){var t=this;this.titles=Array.prototype.slice.call(e.getElementsByTagName("A"));this.titles.forEach(function(e){t.tracks.push(e.href)})};RhythnicAudio.prototype.toggleView=function(e,t){if(e.classList.contains(t))e.classList.remove(t);else e.classList.add(t)};RhythnicAudio.prototype.formatTime=function(e){var t=Math.floor(e%60);return Math.floor(e/60)+":"+(t<10?"0"+t:t)};RhythnicAudio.prototype.removeElementFocus=function(e){e.forEach(function(e){e.setAttribute("tabindex","-1");e.style.setProperty("outline","none")})};RhythnicAudio.prototype.audioTest=function(e){if(!e.canPlayType)throw new Error("Your browser doesn't support the audio tag.\nPlaylist will display as a list of audio links.")};RhythnicAudio.prototype.overrideOptions=function(e,t){for(var n in e){if(!(n in t))t[n]=e[n]}};RhythnicAudio.prototype.defaultOptions={mime:"mp4",autoplay:false,preload:"metadata",hidePlaylist:false,lockPlaylist:false,tracks:{},drawIcons:true};